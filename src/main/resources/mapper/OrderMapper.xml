<?xml version="1.0" encoding="UTF-8" ?>
<!-- mybatis 사이트에서 필요한 링크를 찾을 수 있다 -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.meta.stock.product.mapper.OrderMapper">
    <resultMap id="ProductResultMap" type="com.meta.stock.product.dto.ProductDto">
        <id property="productId" column="PRODUCT_ID"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="lotsId" column="LOTS_ID"/>
    </resultMap>

    <!-- OrderDto 매핑 + ProductDto 포함 -->
    <resultMap id="OrderResultMap" type="com.meta.stock.product.dto.OrderDto">
        <id property="orderId" column="ORDER_ID"/>
        <result property="requestBy" column="REQUEST_BY"/>
        <result property="qty" column="QTY"/>
        <result property="unit" column="UNIT"/>
        <result property="requestDate" column="REQUEST_DATE"/>
        <result property="deadline" column="DEADLINE"/>
        <result property="complete" column="COMPLETE"/>

        <association property="productDto" javaType="com.meta.stock.product.dto.ProductDto" resultMap="ProductResultMap"/>
    </resultMap>

    <!-- 전체 주문 조회 (JOIN) -->
    <select id="findAllOrders" resultMap="OrderResultMap">
        SELECT
        o.ORDER_ID,
        o.REQUEST_BY,
        o.QTY,
        o.UNIT,
        o.REQUEST_DATE,
        o.DEADLINE,
        o.COMPLETE,
        p.PRODUCT_ID,
        p.PRODUCT_NAME,
        p.LOTS_ID
        FROM ORDERS o
        JOIN PRODUCT p ON o.PRODUCT_ID = p.PRODUCT_ID
        <where>
            <if test="keyword != null and keyword != ''">
                o.COMPLETE = #{keyword}
            </if>
        </where>
        ORDER BY o.ORDER_ID DESC
    </select>

    <!-- 특정 주문 조회 (예: ID로) -->
    <select id="findOrderById" parameterType="long" resultMap="OrderResultMap">
        SELECT
        o.ORDER_ID, o.REQUEST_BY, o.QTY, o.UNIT, o.REQUEST_DATE, o.DEADLINE, o.COMPLETE,
        p.PRODUCT_ID, p.PRODUCT_NAME, p.LOTS_ID
        FROM ORDERS o
        JOIN PRODUCT p ON o.PRODUCT_ID = p.PRODUCT_ID
        WHERE o.ORDER_ID = #{orderId}
    </select>
</mapper>