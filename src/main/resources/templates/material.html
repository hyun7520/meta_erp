<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>재료 관리</title>
    <link rel="stylesheet" type="text/css" th:href="@{/style/BaseStyle.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/style/product/material.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script type="text/javascript" th:src="@{/script/baseJS.js}"></script>
</head>
<body>
<div class="container">
    <!-- 네비게이션 바 -->
    <div th:insert="~{navbar :: navbar('재료 관리', '')}"></div>

    <div class="content-wrapper">
        <div class="row">
            <!-- 좌측: 재료 발주 요청 목록 (60%) -->
            <div class="left-section">
                <div class="fragement-box">
                    <div class="action-bar">
                        <h2>
                            <i class="fas fa-clipboard-list"></i>
                            재료 발주 요청 현황
                            <span class="tab-count" th:text="${materialRequests.totalElements}">0</span>
                        </h2>
                        <a th:href="@{/product}" class="btn btn-cancel">
                            <i class="fas fa-arrow-left"></i> 대시보드로
                        </a>
                    </div>

                    <!-- 검색 및 정렬 폼 -->
                    <form method="get" action="/material">
                        <div class="form-row">
                            <div class="form-group">
                                <input type="text" name="keyword" placeholder="재료명 또는 비고 검색" th:value="${keyword}">
                            </div>
                            <div class="form-group">
                                <select name="sortBy">
                                    <option value="requestDate" th:selected="${sortBy == 'requestDate'}">요청일</option>
                                    <option value="materialName" th:selected="${sortBy == 'materialName'}">재료명</option>
                                    <option value="qty" th:selected="${sortBy == 'qty'}">수량</option>
                                    <option value="approved" th:selected="${sortBy == 'approved'}">상태</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <select name="sortDir">
                                    <option value="ASC" th:selected="${sortDir == 'ASC'}">오름차순</option>
                                    <option value="DESC" th:selected="${sortDir == 'DESC'}">내림차순</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-confirm">검색</button>
                            </div>
                        </div>
                    </form>

                    <!-- 발주 요청 테이블 -->
                    <div class="table-container">
                        <table>
                            <thead>
                            <tr>
                                <th class="sortable"
                                    th:classappend="${sortBy == 'mrId'} ? (${sortDir == 'ASC'} ? 'asc' : 'desc')"
                                    th:onclick="|location.href='@{/material(sortBy='mrId', sortDir=${sortBy == 'mrId' and sortDir == 'ASC' ? 'DESC' : 'ASC'}, keyword=${keyword})}'|">
                                    요청ID
                                </th>
                                <th class="sortable"
                                    th:classappend="${sortBy == 'materialName'} ? (${sortDir == 'ASC'} ? 'asc' : 'desc')"
                                    th:onclick="|location.href='@{/material(sortBy='materialName', sortDir=${sortBy == 'materialName' and sortDir == 'ASC' ? 'DESC' : 'ASC'}, keyword=${keyword})}'|">
                                    재료명
                                </th>
                                <th class="sortable"
                                    th:classappend="${sortBy == 'qty'} ? (${sortDir == 'ASC'} ? 'asc' : 'desc')"
                                    th:onclick="|location.href='@{/material(sortBy='qty', sortDir=${sortBy == 'qty' and sortDir == 'ASC' ? 'DESC' : 'ASC'}, keyword=${keyword})}'|">
                                    요청수량
                                </th>
                                <th class="sortable"
                                    th:classappend="${sortBy == 'requestDate'} ? (${sortDir == 'ASC'} ? 'asc' : 'desc')"
                                    th:onclick="|location.href='@{/material(sortBy='requestDate', sortDir=${sortBy == 'requestDate' and sortDir == 'ASC' ? 'DESC' : 'ASC'}, keyword=${keyword})}'|">
                                    요청일
                                </th>
                                <th class="sortable"
                                    th:classappend="${sortBy == 'approved'} ? (${sortDir == 'ASC'} ? 'asc' : 'desc')"
                                    th:onclick="|location.href='@{/material(sortBy='approved', sortDir=${sortBy == 'approved' and sortDir == 'ASC' ? 'DESC' : 'ASC'}, keyword=${keyword})}'|">
                                    상태
                                </th>
                                <th>수정</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="req : ${materialRequests.content}"
                                th:classappend="${req.approved == 0 ? 'status-0' : req.approved == 1 ? 'status-1' : 'status-2'}">
                                <td th:text="${req.mrId}">1</td>
                                <td th:text="${req.materialName}">햄</td>
                                <td><span class="qty-unit" th:text="${req.qty}">5000</span></td>
                                <td th:text="${req.requestDate}">2025-11-05</td>
                                <td>
                                        <span th:switch="${req.approved}">
                                            <span th:case="0" class="status-badge status-pending">확인중</span>
                                            <span th:case="1" class="status-badge status-approved">승인</span>
                                            <span th:case="2" class="status-badge status-rejected">완료</span>
                                        </span>
                                </td>
                                <td th:if="${req.approved} == 0">
                                    <a th:href="@{material/update/{id}(id=${req.mrId})}" class="btn btn-approve">수정</a>
                                </td>
                            </tr>
                            <tr th:if="${materialRequests.isEmpty()}">
                                <td colspan="6" style="text-align: center; color: #9CA3AF; padding: 40px;">
                                    발주 요청이 없습니다.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="pagination" th:if="${materialRequests.totalPages > 1}">
                        <button class="pagination-btn"
                                th:disabled="${materialRequests.first}"
                                th:onclick="|location.href='@{/material(page=${materialRequests.number - 1}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}'|">
                            ◀
                        </button>

                        <button class="pagination-btn"
                                th:each="i : ${#numbers.sequence(0, materialRequests.totalPages - 1)}"
                                th:classappend="${i == materialRequests.number} ? 'active'"
                                th:onclick="|location.href='@{/material(page=${i}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}'|"
                                th:text="${i + 1}">
                            1
                        </button>

                        <button class="pagination-btn"
                                th:disabled="${materialRequests.last}"
                                th:onclick="|location.href='@{/material(page=${materialRequests.number + 1}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}'|">
                            ▶
                        </button>
                    </div>
                </div>
            </div>

            <!-- 우측: 통계 및 재료 재고 (40%) -->
            <div class="right-section">
                <!-- 상단: 발주 요청 통계 -->
                <div class="fragement-box" style="flex: 0 0 auto; height: auto; margin-bottom: 20px;">
                    <h3 style="font-size: 16px; color: #374151; margin-bottom: 15px; font-weight: 600;">
                        <i class="fas fa-chart-bar"></i> 발주 요청 통계
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-item pending">
                            <div class="stat-number" th:text="${requestStats != null ? requestStats.pending : 0}">4</div>
                            <div class="stat-label">확인중</div>
                        </div>
                        <div class="stat-item approved">
                            <div class="stat-number" th:text="${requestStats != null ? requestStats.approved : 0}">2</div>
                            <div class="stat-label">승인</div>
                        </div>
                        <div class="stat-item completed">
                            <div class="stat-number" th:text="${requestStats != null ? requestStats.completed : 0}">6</div>
                            <div class="stat-label">완료</div>
                        </div>
                    </div>
                </div>

                <!-- 하단: 현재 재료 재고 -->
                <div class="fragement-box" style="flex: 1;">
                    <h3 style="font-size: 16px; color: #374151; margin-bottom: 15px; font-weight: 600;">
                        <i class="fas fa-warehouse"></i> 현재 재료 재고
                    </h3>
                    <div class="material-list">
                        <div class="material-card" th:each="material : ${materialStocks}">
                            <div class="material-header">
                                <span class="material-name" th:text="${material.materialName}">햄</span>
                                <span class="material-qty" th:text="${material.qty}">5000 g</span>
                            </div>
                            <div class="material-progress">
                                <div class="material-progress-bar"
                                     th:style="'width: ' + ${material.qty > 10000 ? 100 : (material.qty * 100 / 10000)} + '%'">
                                </div>
                            </div>
                        </div>

                        <div th:if="${materialStocks == null or materialStocks.isEmpty()}"
                             style="text-align: center; color: #9CA3AF; padding: 40px;">
                            <i class="fas fa-box-open" style="font-size: 32px; opacity: 0.3; margin-bottom: 10px;"></i>
                            <div>재고 정보가 없습니다.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>